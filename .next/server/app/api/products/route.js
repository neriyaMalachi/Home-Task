"use strict";(()=>{var e={};e.id=684,e.ids=[684],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2345:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{DELETE:()=>m,GET:()=>c,POST:()=>p,PUT:()=>l});var n=r(9303),a=r(8716),o=r(3131),u=r(7070),i=r(2850),d=r(3683);async function c(e){await (0,i.v)();let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1",6),s=parseInt(t.get("limit")||"6",6),n=(r-1)*s;try{let e=await d.O.find().skip(n).limit(s),t=await d.O.countDocuments(),a=Math.ceil(t/s);return u.NextResponse.json({products:e,page:r,totalPages:a})}catch(e){return u.NextResponse.json({message:"Error fetching products",error:e},{status:500})}}async function p(e){await (0,i.v)();try{let t=await e.json(),r=new d.O(t);return await r.save(),u.NextResponse.json({message:"Product created successfully",product:r})}catch(e){return u.NextResponse.json({message:"Error creating product",error:e},{status:500})}}async function l(e){await (0,i.v)();try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return u.NextResponse.json({message:"Product ID is required"},{status:400});let s=await e.json(),n=await d.O.findByIdAndUpdate(r,s,{new:!0});if(!n)return u.NextResponse.json({message:"Product not found"},{status:404});return u.NextResponse.json({message:"Product updated successfully",product:n})}catch(e){return u.NextResponse.json({message:"Error updating product",error:e},{status:500})}}async function m(e){await (0,i.v)();try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return u.NextResponse.json({message:"Product ID is required"},{status:400});if(!await d.O.findByIdAndDelete(r))return u.NextResponse.json({message:"Product not found"},{status:404});return u.NextResponse.json({message:"Product deleted successfully"})}catch(e){return u.NextResponse.json({message:"Error deleting product",error:e},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"C:\\Users\\Neriya Malachi\\Desktop\\home-work\\src\\app\\api\\products\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:w,serverHooks:f}=g,x="/api/products/route";function v(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:w})}},2850:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(1185),n=r.n(s);let a=process.env.MONGODB_URI||"";if(!a)throw Error("Missing MONGODB_URI in .env file");let o=async()=>{n().connection.readyState>=1||await n().connect(a)}},3683:(e,t,r)=>{r.d(t,{O:()=>u});var s=r(1185),n=r.n(s);let a=new s.Schema({_id:{type:n().Schema.Types.ObjectId,auto:!0},reviewer:{type:String,required:!0},rating:{type:Number,required:!0,min:1,max:5},comment:{type:String,required:!0},createdAt:{type:Date,default:Date.now}}),o=new s.Schema({name:{type:String,required:!0,unique:!0},description:{type:String,required:!0},price:{type:Number,required:!0},image:{type:String,required:!0},reviews:{type:[a],default:[]}}),u=s.models.Product||(0,s.model)("Product",o)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972],()=>r(2345));module.exports=s})();